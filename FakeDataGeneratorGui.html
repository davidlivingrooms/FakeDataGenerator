<!DOCTYPE html>
<html style="padding:20px">
<head>
  <meta charset="utf-8">
  <title>Fake Data Generator</title>

  <script type="text/javascript">
    document.write('<link rel="import" href="' + window.Alteryx.LibDir + '2/lib/includes.html">');
  </script>
</head>
<body>
    <fieldset>
      <legend class='blueTitle'>Options</legend>
      <div class='rightCon'>
        <label>Number of Records to generate</label>
          <ayx data-ui-props="{type: 'NumericSpinner', widgetId: 'numRecordsSpinner'}" data-item-props="{dataName: 'numRecords'}"></ayx>
      </div>

   </fieldset>

    <fieldset>
      <legend class='blueTitle'>Column Builder</legend>
      <div id="container" class="container">
        <div id="row" class="row">
          <label>Column Name</label>
          <ayx data-ui-props="{type: 'TextBox', widgetId: 'columnNameTextBox', 'placeholder': 'Enter new column name here'}" data-item-props="{dataName: 'columnName'}"></ayx>
          <label>XMSG("Provider")</label>
          <ayx data-ui-props="{type: 'DropDown', widgetId: 'providerDropDown'}", data-item-props="window.Alteryx.Gui.FakeDataGenerator.fakerProviderDataItemConfig"></ayx>
        </div>
      </div>
      <div class='accordion-add' onclick='Alteryx.Gui.FakeDataGenerator.addColumn()'></div>
    </fieldset>

  <script type="text/javascript">

     function appendAyxTagToTarget ({targetEl, dataItemProps, uiProps}) {
      const ayxTag = document.createElement('ayx')
      ayxTag.setAttribute('data-ui-props', `${JSON.stringify(uiProps)}`)
//      ayxTag.setAttribute('data-item-props', `${JSON.stringify(dataItemProps)}`)
      targetEl.appendChild(ayxTag)
    }

    window.Alteryx.Gui.FakeDataGenerator = {
      fakerProviderDataItemConfig: {
        dataName: 'fakerProvider',
        optionList: [
          {
            value: 'address',
            label: 'Address'
          },
          {
            value: 'country',
            label: 'Country'
          }
        ]
      },
      addColumn: function () {
        // add container
        const row = document.createElement('div')
        row.className = 'row'

        // add textbox label
        const textBoxLabel = document.createElement('label')
        textBoxLabel.innerText = 'Column Name'
        row.appendChild(textBoxLabel)

        // add textbox
        const textBoxUniqueId = Math.random() + Date.now()
        const textBoxDataItemProps = {
          dataName: `columnName_${textBoxUniqueId}`,
        }

        const textBoxUIProps = {
          type: 'TextBox',
          widgetId: `columnName_${textBoxUniqueId}`,
          placeholder: 'Enter new column name here'
        }

        appendAyxTagToTarget({
          targetEl: row,
          dataItemProps: textBoxDataItemProps,
          uiProps: textBoxUIProps
        })

        // add dropdown label
        const dropDownLabel = document.createElement('label')
        dropDownLabel.innerText = 'Type'
        row.appendChild(dropDownLabel)

        // add dropdown
        const providerUniqueId = Math.random() + Date.now()
        const providerDataItemProps = {
          dataName: `providerType_${providerUniqueId}`,
          optionList: window.Alteryx.Gui.FakeDataGenerator.fakerProviderDataItemConfig.optionList,
        }

        const providerUIProps = {
          type: 'DropDown',
          widgetId: `providerType_${providerUniqueId}`,
        }

        appendAyxTagToTarget({
          targetEl: row,
          dataItemProps: providerDataItemProps,
          uiProps: providerUIProps
        })

        document.getElementById('container').appendChild(row)

        // render the row
        window.Alteryx.Gui.Manager.addWidget(row)
      },
    }

    Alteryx.Gui.BeforeLoad = function (manager, AlteryxDataItems, json) {
      const columnDataItemContainer = new AlteryxDataItems.DataItemContainer('columns')
      manager.addDataItem(columnDataItemContainer)

//      const columnNameUniqueId = Math.random() + Date.now()
//      const columnNameDataItem = new AlteryxDataItems.SimpleString('columnName')
//      if (json.Configuration) {
//        Object.keys(json.Configuration).forEach(() => {
//
//        })
//      }
    }

  </script>

  <style>
    /*This styling needs to be here. Is due to file loading. Otherwise, will not get proper styling on dropdowns*/

    .Select, .Select div, .Select input, .Select span {
      box-sizing: content-box;
      -webkit-box-sizing: content-box;
    }

    .accordion-add {
      background-image: url('./img/add.png');
      background-repeat: no-repeat;
      width: 20px;
      height: 20px;
      background-color: #1691c6;
      background-size: 14px;
      background-position: 3px;
      margin-left: calc(100% - 20px);
      cursor: pointer;
      clear: both;
    }

  </style>
</body>
</html>
